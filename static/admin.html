<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub íŒŒì¼ ì—ë””í„° (PAT)</title>
    <style>
        body { font-family: sans-serif; line-height: 1.6; padding: 20px; }
        .container { max-width: 900px; margin: auto; }
        .section { margin-bottom: 20px; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="text"], input[type="password"], select, textarea {
            width: calc(100% - 22px); /* Adjust for padding */
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }
        textarea { height: 300px; font-family: monospace; }
        button {
            padding: 10px 15px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            margin-right: 5px;
        }
        button:hover { background-color: #0056b3; }
        button:disabled { background-color: #ccc; cursor: not-allowed; }
        #fileList ul { list-style: none; padding: 0; }
        #fileList li { padding: 5px 0; border-bottom: 1px solid #eee; cursor: pointer; }
        #fileList li:hover { background-color: #f0f0f0; }
        #fileList li.dir::before { content: 'ğŸ“ '; }
        #fileList li.file::before { content: 'ğŸ“„ '; }
        #statusBar { margin-top: 15px; color: #555; font-style: italic; }
        .hidden { display: none; }
        .error { color: red; font-weight: bold; }
        .breadcrumb a { text-decoration: none; color: #007bff; }
        .breadcrumb a:hover { text-decoration: underline; }
        .breadcrumb span { margin: 0 5px; color: #888; }
    </style>
</head>
<body>

<div class="container">
    <h1>GitHub íŒŒì¼ ì—ë””í„° (PAT ì‚¬ìš©)</h1>

    <!-- 1. Login Section -->
    <div id="loginSection" class="section">
        <h2>1. GitHub ë¡œê·¸ì¸</h2>
        <p class="error"><strong>ê²½ê³ :</strong> Personal Access Tokenì„ ë¸Œë¼ìš°ì €ì— ì…ë ¥í•˜ëŠ” ê²ƒì€ ë³´ì•ˆìƒ ìœ„í—˜í•©ë‹ˆë‹¤. ê°œì¸ì ì¸ ìš©ë„ë¡œë§Œ ì‚¬ìš©í•˜ê³  í† í° ê´€ë¦¬ì— ìœ ì˜í•˜ì„¸ìš”.</p>
        <label for="patInput">Personal Access Token (PAT):</label>
        <input type="password" id="patInput" placeholder="repo ê¶Œí•œì´ ìˆëŠ” PAT ì…ë ¥">
        <button id="loginButton">ì €ì¥ì†Œ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°</button>
    </div>

    <!-- 2. Repository Selection -->
    <div id="repoSection" class="section hidden">
        <h2>2. ì €ì¥ì†Œ ì„ íƒ</h2>
        <label for="repoSelect">ì €ì¥ì†Œ:</label>
        <select id="repoSelect"></select>
        <button id="loadRepoButton" disabled>íŒŒì¼ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°</button>
    </div>

    <!-- 3. File Browser -->
    <div id="fileBrowserSection" class="section hidden">
        <h2>3. íŒŒì¼ íƒìƒ‰ê¸°</h2>
        <div><strong>í˜„ì¬ ì €ì¥ì†Œ:</strong> <span id="currentRepo"></span></div>
        <div class="breadcrumb"><strong>ê²½ë¡œ:</strong> <span id="currentPathBreadcrumb">/</span></div>
        <div id="fileList">
            <ul></ul>
        </div>
        <button id="createNewFileButton">ìƒˆ íŒŒì¼ ë§Œë“¤ê¸°</button>
    </div>

    <!-- 4. File Editor -->
    <div id="editorSection" class="section hidden">
        <h2>4. íŒŒì¼ í¸ì§‘ê¸°</h2>
        <input type="hidden" id="currentFileSha">
        <input type="hidden" id="currentFilePathInput">

        <label for="fileNameInput">íŒŒì¼ ê²½ë¡œ (í˜„ì¬ í´ë” ê¸°ì¤€):</label>
        <input type="text" id="fileNameInput" placeholder="ì˜ˆ: new-file.md">

        <label for="fileContentInput">íŒŒì¼ ë‚´ìš©:</label>
        <textarea id="fileContentInput"></textarea>

        <label for="commitMessageInput">ì»¤ë°‹ ë©”ì‹œì§€:</label>
        <input type="text" id="commitMessageInput" placeholder="ì˜ˆ: íŒŒì¼ ìƒì„± ë˜ëŠ” ìˆ˜ì •">

        <button id="saveFileButton">ì €ì¥ (ìƒì„±/ìˆ˜ì •)</button>
        <button id="deleteFileButton">ì‚­ì œ</button>
        <button id="cancelEditButton">ì·¨ì†Œ</button>
    </div>

    <!-- Status Bar -->
    <div id="statusBar">ìƒíƒœ: ëŒ€ê¸° ì¤‘...</div>

</div>

<script>
    const GITHUB_API_BASE = 'https://api.github.com';
    let githubToken = null;
    let selectedOwner = null;
    let selectedRepo = null;
    let currentPath = ''; // í˜„ì¬ íƒìƒ‰ ì¤‘ì¸ ê²½ë¡œ
    let currentFiles = []; // í˜„ì¬ ê²½ë¡œì˜ íŒŒì¼/í´ë” ëª©ë¡ ìºì‹œ

    // --- DOM Elements ---
    const patInput = document.getElementById('patInput');
    const loginButton = document.getElementById('loginButton');
    const repoSelect = document.getElementById('repoSelect');
    const loadRepoButton = document.getElementById('loadRepoButton');
    const fileListUl = document.querySelector('#fileList ul');
    const currentRepoSpan = document.getElementById('currentRepo');
    const currentPathBreadcrumb = document.getElementById('currentPathBreadcrumb');
    const fileNameInput = document.getElementById('fileNameInput');
    const fileContentInput = document.getElementById('fileContentInput');
    const commitMessageInput = document.getElementById('commitMessageInput');
    const currentFileShaInput = document.getElementById('currentFileSha');
    const currentFilePathInput = document.getElementById('currentFilePathInput');
    const saveFileButton = document.getElementById('saveFileButton');
    const deleteFileButton = document.getElementById('deleteFileButton');
    const cancelEditButton = document.getElementById('cancelEditButton');
    const createNewFileButton = document.getElementById('createNewFileButton');
    const statusBar = document.getElementById('statusBar');

    // --- Sections ---
    const loginSection = document.getElementById('loginSection');
    const repoSection = document.getElementById('repoSection');
    const fileBrowserSection = document.getElementById('fileBrowserSection');
    const editorSection = document.getElementById('editorSection');

    // --- Helper Functions ---
    function updateStatus(message, isError = false) {
        statusBar.textContent = `ìƒíƒœ: ${message}`;
        statusBar.className = isError ? 'error' : '';
        console.log(message);
    }

    function showSection(sectionToShow) {
        [loginSection, repoSection, fileBrowserSection, editorSection].forEach(section => {
            section.classList.add('hidden');
        });
        if (sectionToShow) {
            sectionToShow.classList.remove('hidden');
        }
    }

    async function githubApiRequest(endpoint, options = {}) {
        if (!githubToken) {
            throw new Error('GitHub PATê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
        }

        const url = endpoint.startsWith('http') ? endpoint : `${GITHUB_API_BASE}${endpoint}`;
        const headers = {
            'Authorization': `Bearer ${githubToken}`,
            'Accept': 'application/vnd.github.v3+json',
            ...options.headers,
        };

        // POST, PUT, DELETE ìš”ì²­ ì‹œ Content-Type ì„¤ì •
        if (options.method && ['POST', 'PUT', 'DELETE'].includes(options.method.toUpperCase()) && options.body) {
            headers['Content-Type'] = 'application/json';
        }

        updateStatus('GitHub API ìš”ì²­ ì¤‘...');
        try {
            const response = await fetch(url, { ...options, headers });
            if (!response.ok) {
                const errorData = await response.json().catch(() => ({ message: 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜' }));
                // PATê°€ ìœ íš¨í•˜ì§€ ì•Šê±°ë‚˜ ê¶Œí•œì´ ì—†ì„ ë•Œ (401 Unauthorized) ì‚¬ìš©ìì—ê²Œ í”¼ë“œë°±
                if (response.status === 401) {
                     throw new Error(`GitHub API ì¸ì¦ ì˜¤ë¥˜ (${response.status}): PATê°€ ìœ íš¨í•˜ì§€ ì•Šê±°ë‚˜ í•„ìš”í•œ ê¶Œí•œ(repo)ì´ ì—†ìŠµë‹ˆë‹¤.`);
                }
                throw new Error(`GitHub API ì˜¤ë¥˜ (${response.status}): ${errorData.message || response.statusText}`);
            }
             // DELETE ìš”ì²­ì€ ë‚´ìš©ì´ ì—†ì„ ìˆ˜ ìˆìŒ
            if (response.status === 204 || response.headers.get('Content-Length') === '0') {
                 updateStatus('GitHub API ìš”ì²­ ì„±ê³µ.');
                 return null; // No content
            }
            const data = await response.json();
            updateStatus('GitHub API ìš”ì²­ ì„±ê³µ.');
            return data;
        } catch (error) {
            updateStatus(`ì˜¤ë¥˜: ${error.message}`, true);
            // ì¸ì¦ ì˜¤ë¥˜ ì‹œ ë¡œê·¸ì¸ ë²„íŠ¼ í™œì„±í™”í•˜ì—¬ ì¬ì‹œë„ ìœ ë„
            if (error.message.includes('ì¸ì¦ ì˜¤ë¥˜')) {
                patInput.disabled = false;
                loginButton.disabled = false;
                showSection(loginSection); // ë¡œê·¸ì¸ ì„¹ì…˜ìœ¼ë¡œ ë˜ëŒë¦¼
            }
            throw error; // Re-throw for further handling
        }
    }

    // Base64 ì¸ì½”ë”©/ë””ì½”ë”© (UTF-8 ì§€ì›)
    function b64EncodeUnicode(str) {
        return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g, function(match, p1) {
            return String.fromCharCode('0x' + p1);
        }));
    }

    function b64DecodeUnicode(str) {
        // ë¨¼ì € atobë¡œ ë””ì½”ë”© ì‹œë„
        let decoded_string;
        try {
             decoded_string = atob(str);
        } catch (e) {
             console.error("Base64 ë””ì½”ë”© ì‹¤íŒ¨ (atob):", e);
             // ë””ì½”ë”© ì‹¤íŒ¨ ì‹œ ì›ë³¸ ë¬¸ìì—´ì´ë‚˜ ë¹ˆ ë¬¸ìì—´ ë°˜í™˜, í˜¹ì€ ì˜¤ë¥˜ ì²˜ë¦¬
             updateStatus('Base64 ë””ì½”ë”© ì¤‘ ì˜¤ë¥˜ ë°œìƒ. íŒŒì¼ ë‚´ìš©ì´ ì†ìƒë˜ì—ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.', true);
             return "[ë””ì½”ë”© ì˜¤ë¥˜]"; // ì‚¬ìš©ìì—ê²Œ ì˜¤ë¥˜ í‘œì‹œ
        }

        // UTF-8 ë³€í™˜ ì‹œë„
        try {
            return decodeURIComponent(decoded_string.split('').map(function(c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));
        } catch (e) {
             console.error("UTF-8 ë””ì½”ë”© ì‹¤íŒ¨:", e);
             updateStatus('UTF-8 ë””ì½”ë”© ì¤‘ ì˜¤ë¥˜ ë°œìƒ. íŒŒì¼ì´ UTF-8ì´ ì•„ë‹ ìˆ˜ ìˆìŠµë‹ˆë‹¤.', true);
             // UTF-8 ë³€í™˜ ì‹¤íŒ¨ ì‹œ atob ê²°ê³¼ë¼ë„ ë°˜í™˜ (ê¹¨ì§ˆ ìˆ˜ ìˆìŒ)
             return decoded_string;
        }
    }


    // ê²½ë¡œ Breadcrumb ìƒì„±
    function updateBreadcrumb() {
        currentPathBreadcrumb.innerHTML = ''; // Clear existing
        const pathParts = currentPath.split('/').filter(p => p); // ë¹ˆ ìš”ì†Œ ì œê±°
        const rootLink = document.createElement('a');
        rootLink.href = '#';
        rootLink.textContent = '/';
        rootLink.onclick = (e) => { e.preventDefault(); fetchContents(''); };
        currentPathBreadcrumb.appendChild(rootLink);

        let accumulatedPath = '';
        pathParts.forEach((part, index) => {
            accumulatedPath += (accumulatedPath ? '/' : '') + part;
            const pathSpan = document.createElement('span');
            pathSpan.textContent = '>';
            currentPathBreadcrumb.appendChild(pathSpan);

            const partLink = document.createElement('a');
            partLink.href = '#';
            partLink.textContent = part;
            // í´ë¡œì €ë¥¼ ì‚¬ìš©í•˜ì—¬ ì˜¬ë°”ë¥¸ ê²½ë¡œ ì „ë‹¬
            const currentAccumulatedPath = accumulatedPath;
            partLink.onclick = (e) => { e.preventDefault(); fetchContents(currentAccumulatedPath); };
            currentPathBreadcrumb.appendChild(partLink);
        });
         // ë§ˆì§€ë§‰ì— ìŠ¬ë˜ì‹œ ì¶”ê°€ (ë£¨íŠ¸ê°€ ì•„ë‹ ê²½ìš°)
        if (currentPath) {
             const trailingSlash = document.createElement('span');
             trailingSlash.textContent = '/';
             currentPathBreadcrumb.appendChild(trailingSlash);
        }
    }


    // --- Event Handlers ---

    // 1. Login
    loginButton.addEventListener('click', async () => {
        githubToken = patInput.value.trim();
        if (!githubToken) {
            updateStatus('PATë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', true);
            return;
        }
        patInput.disabled = true;
        loginButton.disabled = true;
        loadRepoButton.disabled = true; // ë¡œë”© ì¤‘ì—ëŠ” ë¹„í™œì„±í™”
        updateStatus('ì €ì¥ì†Œ ëª©ë¡ ë¡œë”© ì¤‘...');
        try {
            // /user/repos ëŠ” ì¸ì¦ëœ ì‚¬ìš©ìì˜ ëª¨ë“  ì €ì¥ì†Œë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
            // í˜ì´ì§€ë„¤ì´ì…˜ì„ ê³ ë ¤í•˜ì—¬ ìµœëŒ€ 100ê°œê¹Œì§€ ìš”ì²­ (í•„ìš”ì‹œ ë°˜ë³µ ìš”ì²­ êµ¬í˜„)
            // sort=updated: ìµœê·¼ ì—…ë°ì´íŠ¸ëœ ì €ì¥ì†Œ ìˆœìœ¼ë¡œ ì •ë ¬ (ë” ê´€ë ¨ì„± ë†’ì„ ìˆ˜ ìˆìŒ)
            const repos = await githubApiRequest('/user/repos?per_page=100&sort=updated');

            repoSelect.innerHTML = '<option value="">-- ì €ì¥ì†Œ ì„ íƒ --</option>'; // Clear previous options

            if (repos && repos.length > 0) {
                 repos.forEach(repo => {
                    const option = document.createElement('option');
                    option.value = `${repo.owner.login}/${repo.name}`;
                    option.textContent = repo.full_name;
                    repoSelect.appendChild(option);
                });

                // --- ìˆ˜ì •ëœ ë¶€ë¶„ ---
                // ì²« ë²ˆì§¸ ì €ì¥ì†Œë¥¼ ê¸°ë³¸ìœ¼ë¡œ ì„ íƒ
                repoSelect.selectedIndex = 1;
                // ì²« ë²ˆì§¸ ì €ì¥ì†Œê°€ ì„ íƒë˜ì—ˆìœ¼ë¯€ë¡œ 'íŒŒì¼ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°' ë²„íŠ¼ í™œì„±í™”
                loadRepoButton.disabled = false;
                // --- ìˆ˜ì • ë ---

                updateStatus(`${repos.length}ê°œì˜ ì €ì¥ì†Œ ëª©ë¡ ë¡œë“œ ì™„ë£Œ.`);

            } else {
                updateStatus('ì ‘ê·¼ ê°€ëŠ¥í•œ ì €ì¥ì†Œê°€ ì—†ê±°ë‚˜ ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', true);
                // ì €ì¥ì†Œê°€ ì—†ìœ¼ë©´ 'íŒŒì¼ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°' ë²„íŠ¼ ë¹„í™œì„±í™” ìœ ì§€
                loadRepoButton.disabled = true;
            }

            showSection(repoSection); // ì €ì¥ì†Œ ì„ íƒ ì„¹ì…˜ í‘œì‹œ
            repoSection.classList.remove('hidden');

        } catch (error) {
            // githubApiRequest í•¨ìˆ˜ ë‚´ì—ì„œ ì´ë¯¸ ìƒíƒœ ì—…ë°ì´íŠ¸ ë° ì˜¤ë¥˜ ì²˜ë¦¬ê°€ ì´ë£¨ì–´ì§
            // ì¶”ê°€ì ì¸ UI ë³µêµ¬ ë¡œì§ì´ í•„ìš”í•˜ë‹¤ë©´ ì—¬ê¸°ì— ì‘ì„± (ì˜ˆ: ë¡œê·¸ì¸ ë²„íŠ¼ ì¬í™œì„±í™”)
            // patInput.disabled = false; // githubApiRequestì—ì„œ ì²˜ë¦¬í•˜ë„ë¡ ë³€ê²½
            // loginButton.disabled = false; // githubApiRequestì—ì„œ ì²˜ë¦¬í•˜ë„ë¡ ë³€ê²½
        }
    });

    // 2. Repository Selection
    repoSelect.addEventListener('change', () => {
        // '-- ì €ì¥ì†Œ ì„ íƒ --'ì´ ì•„ë‹ˆë©´ ë²„íŠ¼ í™œì„±í™”, ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ë¹„í™œì„±í™”
        loadRepoButton.disabled = repoSelect.value === '';
    });

    loadRepoButton.addEventListener('click', () => {
        const selectedRepoFullName = repoSelect.value;
        if (!selectedRepoFullName) return;

        [selectedOwner, selectedRepo] = selectedRepoFullName.split('/');
        currentRepoSpan.textContent = selectedRepoFullName;
        updateStatus(`'${selectedRepoFullName}' ì €ì¥ì†Œ íŒŒì¼ ëª©ë¡ ë¡œë”©...`);
        showSection(fileBrowserSection); // Show file browser
        fetchContents(''); // Load root directory
    });

    // 3. Fetch Repository Contents (Files/Folders)
    async function fetchContents(path) {
        currentPath = path;
        updateBreadcrumb(); // Update breadcrumb based on the new path
        fileListUl.innerHTML = ''; // Clear previous list
        updateStatus(`'${selectedOwner}/${selectedRepo}/${path}' ë¡œë”© ì¤‘...`);
        showSection(fileBrowserSection); // Make sure browser is visible

        try {
            // ê²½ë¡œê°€ ë¹„ì–´ ìˆìœ¼ë©´ ë£¨íŠ¸ë¥¼ ì˜ë¯¸, API ìš”ì²­ ì‹œ ìŠ¬ë˜ì‹œ ì œê±°
            const requestPath = path ? path : '';
            const contents = await githubApiRequest(`/repos/${selectedOwner}/${selectedRepo}/contents/${requestPath}`);
            currentFiles = contents.sort((a, b) => { // Sort: folders first, then by name
                if (a.type === b.type) {
                    return a.name.localeCompare(b.name);
                }
                return a.type === 'dir' ? -1 : 1;
            });

            // Add '..' (Up directory) link if not in root
            if (path !== '') {
                const parentPath = path.includes('/') ? path.substring(0, path.lastIndexOf('/')) : ''; // ë£¨íŠ¸ë¡œ ê°ˆ ê²½ìš° ë¹ˆ ë¬¸ìì—´
                const li = document.createElement('li');
                li.textContent = 'â¬†ï¸ .. (ìƒìœ„ í´ë”)';
                li.style.cursor = 'pointer';
                li.style.fontWeight = 'bold';
                li.onclick = () => fetchContents(parentPath);
                fileListUl.appendChild(li);
            }

            // Populate file/directory list
            if (currentFiles.length > 0) {
                currentFiles.forEach(item => {
                    const li = document.createElement('li');
                    li.textContent = item.name;
                    li.classList.add(item.type); // Add 'dir' or 'file' class
                    li.dataset.path = item.path;
                    li.dataset.type = item.type;
                    li.dataset.sha = item.sha; // Store sha for later use (especially for files)

                    if (item.type === 'dir') {
                        li.onclick = () => fetchContents(item.path);
                    } else if (item.type === 'file') {
                        li.onclick = () => fetchFileContent(item.path, item.sha);
                    }
                    fileListUl.appendChild(li);
                });
             } else {
                 const li = document.createElement('li');
                 li.textContent = '(í´ë”ê°€ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤)';
                 li.style.fontStyle = 'italic';
                 li.style.color = '#888';
                 fileListUl.appendChild(li);
             }
             updateStatus(`'${selectedOwner}/${selectedRepo}/${path || '/'}' ë¡œë“œ ì™„ë£Œ.`);
        } catch (error) {
            updateStatus(`íŒŒì¼ ëª©ë¡ ë¡œë”© ì‹¤íŒ¨ (${path || '/'}): ${error.message}`, true);
            // Optionally show the browser section even on error to allow navigation back
            showSection(fileBrowserSection);
        }
    }

    // 4. Fetch File Content
    async function fetchFileContent(filePath, fileSha) {
        updateStatus(`'${filePath}' íŒŒì¼ ë‚´ìš© ë¡œë”© ì¤‘...`);
        showSection(null); // ë¡œë”© ì¤‘ì—ëŠ” ì ì‹œ ì„¹ì…˜ ìˆ¨ê¹€ (ì„ íƒ ì‚¬í•­)
        try {
            const fileData = await githubApiRequest(`/repos/${selectedOwner}/${selectedRepo}/contents/${filePath}`);

            if (fileData.type !== 'file') {
                 throw new Error('ìš”ì²­í•œ ê²½ë¡œëŠ” íŒŒì¼ì´ ì•„ë‹™ë‹ˆë‹¤.');
            }
            if (fileData.encoding !== 'base64') {
                // GitHub APIëŠ” í° íŒŒì¼ì˜ ê²½ìš° contentë¥¼ í¬í•¨í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ
                if (fileData.content === undefined && fileData.download_url) {
                     updateStatus(`íŒŒì¼ì´ ë„ˆë¬´ ì»¤ì„œ ì§ì ‘ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (${fileData.size} bytes)`, true);
                     // ì—ë””í„° ëŒ€ì‹  ë‹¤ìš´ë¡œë“œ ë§í¬ë¥¼ ë³´ì—¬ì£¼ê±°ë‚˜ ë‹¤ë¥¸ ì²˜ë¦¬
                     showSection(fileBrowserSection); // ë¸Œë¼ìš°ì €ë¡œ ë³µê·€
                     alert(`íŒŒì¼ì´ ë„ˆë¬´ ì»¤ì„œ(${fileData.size} bytes) ì—ë””í„°ë¡œ ì—´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\në‹¤ìš´ë¡œë“œ URL: ${fileData.download_url}`);
                     return; // í•¨ìˆ˜ ì¢…ë£Œ
                } else {
                    throw new Error('ì§€ì›í•˜ì§€ ì•ŠëŠ” ì¸ì½”ë”©ì…ë‹ˆë‹¤: ' + fileData.encoding);
                }
            }
            if (fileData.content === undefined || fileData.sha === undefined) {
                 throw new Error('API ì‘ë‹µì— content ë˜ëŠ” shaê°€ ì—†ìŠµë‹ˆë‹¤.');
            }

            const decodedContent = b64DecodeUnicode(fileData.content);

            // Populate editor
            fileNameInput.value = filePath.substring(filePath.lastIndexOf('/') + 1); // Extract filename
            fileContentInput.value = decodedContent;
            commitMessageInput.value = `Update ${fileNameInput.value}`; // Default commit message
            currentFileShaInput.value = fileData.sha; // Store SHA for update/delete
            currentFilePathInput.value = filePath; // Store full path

            // Enable/disable delete button based on whether it's an existing file
            deleteFileButton.disabled = false;
            saveFileButton.textContent = 'ì €ì¥ (ìˆ˜ì •)';
            saveFileButton.disabled = false; // ì €ì¥ ë²„íŠ¼ í™œì„±í™”
            cancelEditButton.disabled = false; // ì·¨ì†Œ ë²„íŠ¼ í™œì„±í™”

            updateStatus(`'${filePath}' ë¡œë“œ ì™„ë£Œ.`);
            showSection(editorSection); // Show editor

        } catch (error) {
            updateStatus(`íŒŒì¼ ë‚´ìš© ë¡œë”© ì‹¤íŒ¨ (${filePath}): ${error.message}`, true);
            showSection(fileBrowserSection); // Go back to browser on error
        }
    }

    // 5. Show Create New File Form
    createNewFileButton.addEventListener('click', () => {
        fileNameInput.value = '';
        fileContentInput.value = '';
        commitMessageInput.value = 'Create new file';
        currentFileShaInput.value = ''; // No SHA for new file
        currentFilePathInput.value = ''; // Path will be constructed on save

        deleteFileButton.disabled = true; // Cannot delete a new file
        saveFileButton.textContent = 'ì €ì¥ (ìƒì„±)';
        saveFileButton.disabled = false; // ì €ì¥ ë²„íŠ¼ í™œì„±í™”
        cancelEditButton.disabled = false; // ì·¨ì†Œ ë²„íŠ¼ í™œì„±í™”


        updateStatus('ìƒˆ íŒŒì¼ ìƒì„± ì¤€ë¹„ ì™„ë£Œ.');
        showSection(editorSection);
        fileNameInput.focus();
    });


    // 6. Save File (Create or Update)
    saveFileButton.addEventListener('click', async () => {
        const fileName = fileNameInput.value.trim();
        const fileContent = fileContentInput.value;
        let commitMessage = commitMessageInput.value.trim();
        const existingSha = currentFileShaInput.value; // SHA for updates
        const isUpdate = !!existingSha;
        // íŒŒì¼ ì´ë¦„ì„ ê¸°ì¤€ìœ¼ë¡œ í•  ì§€, currentFilePathInput ê¸°ì¤€ìœ¼ë¡œ í• ì§€ ëª…í™•íˆ í•¨
        // ì—¬ê¸°ì„œëŠ” ì—ë””í„°ì˜ íŒŒì¼ ì´ë¦„ ì…ë ¥ê°’ì„ ê¸°ì¤€ìœ¼ë¡œ ìƒˆ ê²½ë¡œ ìƒì„±
        const targetFileName = fileName; // ì‚¬ìš©ìê°€ ì…ë ¥í•œ ì´ë¦„ ì‚¬ìš©
        // ìˆ˜ì •ì¼ ê²½ìš° ì›ë˜ ê²½ë¡œì—ì„œ íŒŒì¼ ì´ë¦„ë§Œ ë³€ê²½ë  ìˆ˜ë„ ìˆìœ¼ë¯€ë¡œ, í˜„ì¬ ê²½ë¡œ(currentPath)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•¨
        let fullPath;

        if (!targetFileName) {
            updateStatus('íŒŒì¼ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', true);
            fileNameInput.focus();
            return;
        }

        // íŒŒì¼ ì´ë¦„ì— ìŠ¬ë˜ì‹œ í¬í•¨ ì—¬ë¶€ í™•ì¸ (í•˜ìœ„ í´ë” ìƒì„± ë°©ì§€ ë˜ëŠ” ëª…ì‹œì  í—ˆìš© í•„ìš”)
        if (targetFileName.includes('/')) {
             updateStatus("íŒŒì¼ ì´ë¦„ì— ìŠ¬ë˜ì‹œ('/')ë¥¼ í¬í•¨í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", true);
             fileNameInput.focus();
             return;
        }


        if (isUpdate) {
            // ìˆ˜ì • ì‹œì—ëŠ” ì›ë³¸ íŒŒì¼ì˜ ê²½ë¡œë¥¼ ì‚¬ìš©í•´ì•¼ í•¨
            fullPath = currentFilePathInput.value;
             // ì‚¬ìš©ìê°€ íŒŒì¼ ì´ë¦„ì„ ë³€ê²½í–ˆëŠ”ì§€ í™•ì¸ (í•„ìˆ˜ëŠ” ì•„ë‹˜, UX ê°œì„  ê°€ëŠ¥)
            const originalFileName = fullPath.substring(fullPath.lastIndexOf('/') + 1);
            if (targetFileName !== originalFileName) {
                // íŒŒì¼ ì´ë¦„ ë³€ê²½ì€ 'ì´ë™'ìœ¼ë¡œ ê°„ì£¼ë  ìˆ˜ ìˆì–´ ë³µì¡í•¨. ì—¬ê¸°ì„œëŠ” ë‹¨ìˆœ ì—…ë°ì´íŠ¸ë§Œ ì§€ì›.
                 // í•„ìš”í•˜ë‹¤ë©´ ì´ë¦„ ë³€ê²½ ë¡œì§ ì¶”ê°€ (ì‚­ì œ í›„ ìƒì„± or Move API)
                if (!confirm(`íŒŒì¼ ì´ë¦„ì„ '${originalFileName}'ì—ì„œ '${targetFileName}'(ìœ¼)ë¡œ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ëŠ” ìƒˆ íŒŒì¼ì„ ìƒì„±í•˜ê³  ì´ì „ íŒŒì¼ì„ ì‚­ì œí•˜ëŠ” ê²ƒê³¼ ìœ ì‚¬í•˜ê²Œ ë™ì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`)) {
                     fileNameInput.value = originalFileName; // ì›ë˜ ì´ë¦„ìœ¼ë¡œ ë³µì›
                     return; // ì·¨ì†Œ
                }
                 // ì‹¤ì œ ì´ë¦„ ë³€ê²½ ë¡œì§ì€ GitHub APIì— Move ê¸°ëŠ¥ì´ ì—†ìœ¼ë¯€ë¡œ,
                 // ì—¬ê¸°ì„œëŠ” ìƒˆ ì´ë¦„ìœ¼ë¡œ 'ìƒì„±(PUT)'ë§Œ ì‹œë„í•©ë‹ˆë‹¤.
                 // GitHubëŠ” ë™ì¼ SHAê°€ ì•„ë‹ˆë©´ ë®ì–´ì“°ê¸°ë¡œ ì²˜ë¦¬í•  ê²ƒì…ë‹ˆë‹¤.
                 // ë§Œì•½ ì´ë™(rename)ì„ ì •í™•íˆ êµ¬í˜„í•˜ë ¤ë©´ delete í›„ create í•„ìš”.
                 // ì—¬ê¸°ì„œëŠ” ì¼ë‹¨ PUT ìš”ì²­ìœ¼ë¡œ ì²˜ë¦¬í•˜ê³ , ì»¤ë°‹ ë©”ì‹œì§€ì— ë°˜ì˜ ê³ ë ¤.
                 commitMessage = commitMessage || `Rename ${originalFileName} to ${targetFileName} and update content`;
                 // fullPathëŠ” *í˜„ì¬* ì €ì¥í•˜ë ¤ëŠ” ê²½ë¡œ. ì—¬ê¸°ì„œëŠ” íŒŒì¼ ì´ë¦„ë§Œ ë³€ê²½ëœ ìƒíƒœë¡œ ì‚¬ìš©
                 const basePath = currentPath ? currentPath + '/' : '';
                 fullPath = basePath + targetFileName;
                 // ì¤‘ìš”: ì´ ê²½ìš° shaë¥¼ ë³´ë‚´ë©´ ì•ˆë  ìˆ˜ë„ ìˆìŒ(ìƒˆ íŒŒì¼ ìƒì„±ìœ¼ë¡œ ê°„ì£¼). API í…ŒìŠ¤íŠ¸ í•„ìš”.
                 // ì•ˆì „í•˜ê²Œ í•˜ë ¤ë©´ isUpdateë¥¼ falseë¡œ ì·¨ê¸‰í•˜ê±°ë‚˜, ëª…ì‹œì  Rename ì§€ì› í•„ìš”.
                 // ì—¬ê¸°ì„œëŠ” ì¼ë‹¨ ê¸°ì¡´ ë¡œì§(sha í¬í•¨ PUT) ìœ ì§€í•˜ë‚˜, ì‹¤íŒ¨ ê°€ëŠ¥ì„± ì¸ì§€.
                 // Update: GitHub PUT contents APIëŠ” ê²½ë¡œ ë³€ê²½ ì‹œ ìë™ìœ¼ë¡œ ì´ë™(rename) ì²˜ë¦¬í•¨. SHA í•„ìš”.
                 console.warn("íŒŒì¼ ì´ë¦„ ë³€ê²½ ì‹œë„:", originalFileName, "->", targetFileName);
            }

        } else {
            // ìƒì„± ì‹œì—ëŠ” í˜„ì¬ í´ë”(currentPath)ì— ìƒˆ íŒŒì¼ ì´ë¦„ ê²°í•©
            fullPath = (currentPath ? currentPath + '/' : '') + targetFileName;
        }


        if (!commitMessage) {
            commitMessage = isUpdate ? `Update ${targetFileName}` : `Create ${targetFileName}`;
        }

        updateStatus(`'${fullPath}' ì €ì¥ ì¤‘...`);
        saveFileButton.disabled = true;
        cancelEditButton.disabled = true;
        deleteFileButton.disabled = true;

        try {
            const encodedContent = b64EncodeUnicode(fileContent);
            const body = {
                message: commitMessage,
                content: encodedContent,
                branch: 'main' // TODO: ë¸Œëœì¹˜ ì„ íƒ ê¸°ëŠ¥ ì¶”ê°€
            };

            // ìˆ˜ì •(Update)ì¼ ê²½ìš°ì—ë§Œ SHA ì¶”ê°€
            if (isUpdate) {
                 // íŒŒì¼ ê²½ë¡œê°€ ì—ë””í„° ë¡œë“œ ì‹œì ê³¼ ë‹¤ë¥¸ì§€ ìµœì¢… í™•ì¸ (ì´ë¦„ ë³€ê²½ ì¼€ì´ìŠ¤ëŠ” ìœ„ì—ì„œ ì²˜ë¦¬)
                 if (currentFilePathInput.value !== fullPath && fileNameInput.value === fullPath.substring(fullPath.lastIndexOf('/') + 1)) {
                    // ê²½ë¡œ ìì²´ëŠ” ë™ì¼í•œë°, currentFilePathInputì´ ë‹¤ë¥¸ ê²½ìš°? -> ë¡œì§ ì˜¤ë¥˜ ê°€ëŠ¥ì„±
                    console.error("Internal state mismatch: currentFilePathInput vs constructed fullPath");
                    // throw new Error("ë‚´ë¶€ ìƒíƒœ ì˜¤ë¥˜ ë°œìƒ. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ê³  ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.");
                    // ì¼ë‹¨ ì§„í–‰í•˜ë˜ ê²½ê³  ë‚¨ê¹€
                 }
                body.sha = existingSha;
            }

            // API ìš”ì²­ (ìƒì„±/ìˆ˜ì • ëª¨ë‘ PUT ì‚¬ìš©)
            const result = await githubApiRequest(`/repos/${selectedOwner}/${selectedRepo}/contents/${fullPath}`, {
                method: 'PUT',
                body: JSON.stringify(body)
            });

            updateStatus(`'${fullPath}' ${isUpdate ? 'ìˆ˜ì •' : 'ìƒì„±'} ì™„ë£Œ.`);
            // ì €ì¥ ì„±ê³µ ì‹œ íŒŒì¼ ë¸Œë¼ìš°ì €ë¡œ ëŒì•„ê°€ì„œ í˜„ì¬ ê²½ë¡œ ìƒˆë¡œê³ ì¹¨
            fetchContents(currentPath); // ì €ì¥ëœ íŒŒì¼ì´ ìˆëŠ” í´ë” ìƒˆë¡œê³ ì¹¨

        } catch (error) {
            updateStatus(`íŒŒì¼ ì €ì¥ ì‹¤íŒ¨ (${fullPath}): ${error.message}`, true);
            // ì‹¤íŒ¨ ì‹œ ë²„íŠ¼ ë‹¤ì‹œ í™œì„±í™” (ì‚­ì œ ë²„íŠ¼ì€ ì›ë˜ ìƒíƒœ ë”°ë¼ê°)
            saveFileButton.disabled = false;
            cancelEditButton.disabled = false;
            deleteFileButton.disabled = !isUpdate; // ìˆ˜ì • ì¤‘ì´ì—ˆì„ ë•Œë§Œ ì‚­ì œ ë²„íŠ¼ í™œì„±í™”
        }
        // finally ë¸”ë¡ ë¶ˆí•„ìš” (ì„±ê³µ/ì‹¤íŒ¨ ëª¨ë‘ ì²˜ë¦¬ë¨)
    });

    // 7. Delete File
    deleteFileButton.addEventListener('click', async () => {
        const filePathToDelete = currentFilePathInput.value;
        const fileShaToDelete = currentFileShaInput.value;

        if (!filePathToDelete || !fileShaToDelete) {
            updateStatus('ì‚­ì œí•  íŒŒì¼ ì •ë³´ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.', true);
            return;
        }

        if (!confirm(`ì •ë§ë¡œ '${filePathToDelete}' íŒŒì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) {
            return;
        }

        let commitMessage = commitMessageInput.value.trim();
         // ì»¤ë°‹ ë©”ì‹œì§€ê°€ ë¹„ì–´ìˆê±°ë‚˜, 'update' ê´€ë ¨ ë©”ì‹œì§€ì´ë©´ ê¸°ë³¸ ì‚­ì œ ë©”ì‹œì§€ë¡œ ë³€ê²½
         if (!commitMessage || commitMessage.toLowerCase().startsWith('update')) {
             commitMessage = `Delete ${filePathToDelete.substring(filePathToDelete.lastIndexOf('/') + 1)}`;
         }


        updateStatus(`'${filePathToDelete}' ì‚­ì œ ì¤‘...`);
        saveFileButton.disabled = true;
        cancelEditButton.disabled = true;
        deleteFileButton.disabled = true;

        try {
            await githubApiRequest(`/repos/${selectedOwner}/${selectedRepo}/contents/${filePathToDelete}`, {
                method: 'DELETE',
                body: JSON.stringify({
                    message: commitMessage,
                    sha: fileShaToDelete,
                    branch: 'main' // TODO: ë¸Œëœì¹˜ ì„ íƒ ê¸°ëŠ¥ ì¶”ê°€
                })
            });

            updateStatus(`'${filePathToDelete}' ì‚­ì œ ì™„ë£Œ.`);
            // ì‚­ì œ ì„±ê³µ ì‹œ íŒŒì¼ ë¸Œë¼ìš°ì €ë¡œ ëŒì•„ê°€ì„œ í˜„ì¬ ê²½ë¡œ ìƒˆë¡œê³ ì¹¨
            fetchContents(currentPath); // íŒŒì¼ì´ ì‚­ì œëœ í´ë” ìƒˆë¡œê³ ì¹¨

        } catch (error) {
            updateStatus(`íŒŒì¼ ì‚­ì œ ì‹¤íŒ¨ (${filePathToDelete}): ${error.message}`, true);
             // ì‹¤íŒ¨ ì‹œ ë²„íŠ¼ ë‹¤ì‹œ í™œì„±í™” (ì‚­ì œ ë²„íŠ¼ í¬í•¨)
            saveFileButton.disabled = false;
            cancelEditButton.disabled = false;
            deleteFileButton.disabled = false; // ì‚­ì œ ì‹¤íŒ¨ ì‹œ ë‹¤ì‹œ ì‹œë„ ê°€ëŠ¥í•˜ë„ë¡ í™œì„±í™”
        }
    });

    // 8. Cancel Edit
    cancelEditButton.addEventListener('click', () => {
        updateStatus('í¸ì§‘ ì·¨ì†Œë¨.');
        // ì—ë””í„° ë‚´ìš© ì´ˆê¸°í™”í•˜ê³  íŒŒì¼ ë¸Œë¼ìš°ì € ì„¹ì…˜ í‘œì‹œ
        fileNameInput.value = '';
        fileContentInput.value = '';
        commitMessageInput.value = '';
        currentFileShaInput.value = '';
        currentFilePathInput.value = '';
        showSection(fileBrowserSection);
        // ë¸Œë¼ìš°ì € ë‚´ìš©ì„ ë‹¤ì‹œ ë¡œë“œí•  í•„ìš”ëŠ” ì—†ìŒ (ë³€ê²½ì‚¬í•­ ì—†ì—ˆìŒ)
    });


    // --- Initial State ---
    showSection(loginSection); // Start with login section
    updateStatus('ì‹œì‘: GitHub PATë¥¼ ì…ë ¥í•˜ì„¸ìš”.');

</script>

</body>
</html>